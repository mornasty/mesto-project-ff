(()=>{"use strict";function e(e){var n=document.querySelector(".popup_is-opened");"Escape"==e.key&&t(n)}function t(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",e)}function n(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",e)}var o={baseUrl:"https://nomoreparties.co/v1/cohort-mag-4",headers:{authorization:"83dc7d10-651f-4d13-a548-f7dbd5637cbe","Content-Type":"application/json"}};function r(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function c(e,t,n,o,r,c,a,u){var i=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),s=i.querySelector(".card__title"),l=i.querySelector(".card__image"),d=i.querySelector(".card__delete-button"),p=i.querySelector(".card__like-button"),_=i.querySelector(".card__like-counter");return n?d.addEventListener("click",(function(e){n(e,c)})):d.remove(),s.textContent=e,l.src=t,_.textContent=a.length,a.filter((function(e){return e._id===u._id})).length>0&&p.classList.add("card__like-button_is-active"),p.addEventListener("click",(function(e){o(e,_,c)})),l.addEventListener("click",(function(t){r(t,e)})),i}function a(e,t){var n=e.target.closest(".card");(function(e){return fetch(o.baseUrl+"/cards"+"/".concat(e),{method:"DELETE",headers:o.headers}).then((function(e){return r(e)}))})(t).then((function(e){n.remove()})).catch((function(e){console.log(e)}))}function u(e,t,n){e.target.classList.contains("card__like-button_is-active")?(e.target.classList.remove("card__like-button_is-active"),function(e){return fetch(o.baseUrl+"/cards/likes/".concat(e),{method:"DELETE",headers:o.headers}).then((function(e){return r(e)}))}(n).then((function(e){t.textContent=e.likes.length})).catch((function(e){console.log(e)}))):(e.target.classList.add("card__like-button_is-active"),function(e){return fetch(o.baseUrl+"/cards/likes/".concat(e),{method:"PUT",headers:o.headers}).then((function(e){return r(e)}))}(n).then((function(e){t.textContent=e.likes.length})).catch((function(e){console.log(e)})))}var i=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n)):(t.disabled=!0,t.classList.add(n))},s=function(e,t){var n=t.inactiveButtonClass,o=t.submitButtonSelector,r=e.querySelector(o);r.disabled=!r.disabled,r.classList.toggle(n)},l=document.querySelectorAll(".popup"),d=document.querySelector(".popup__image"),p=document.querySelector(".popup__caption"),_=document.querySelector(".popup_type_image"),f=document.querySelector(".popup_type_edit"),m=document.querySelector(".profile__edit-button"),v=document.querySelector(".popup_type_new-card"),y=document.querySelector(".profile__add-button"),h=document.querySelector(".popup__form[name='edit-profile']"),S=h.querySelector(".popup__input_type_name"),b=h.querySelector(".popup__input_type_description"),g=document.querySelector(".profile__title"),q=document.querySelector(".profile__description"),C=document.querySelector(".profile__image"),k=document.querySelector(".popup_type_edit-avatar"),L=document.getElementById("avatar-link"),E=document.querySelector(".popup__form[name='edit-avatar']"),x=document.querySelector(".popup__form[name='new-place']"),U=x.querySelector(".popup__input_type_card-name"),A=x.querySelector(".popup__input_type_url"),B=document.querySelector(".places__list");function T(e,t){d.src=e.target.src,d.alt=t,p.textContent=t,n(_)}l.forEach((function(e){e.classList.add("popup_is-animated"),e.querySelector(".popup__close").addEventListener("click",(function(){t(e)})),e.addEventListener("click",(function(n){n.target==e&&t(e)}))})),m.addEventListener("click",(function(){S.value=g.textContent,b.value=q.textContent,s(h,M),n(f)})),y.addEventListener("click",(function(){n(v)})),C.addEventListener("click",(function(){n(k)})),h.addEventListener("submit",(function(e){e.preventDefault();var n,c,a=e.target.querySelector(".popup__button"),u=a.textContent;a.textContent="Сохранение...",(n=S.value,c=b.value,fetch(o.baseUrl+"/users/me",{method:"PATCH",headers:o.headers,body:JSON.stringify({name:n,about:c})}).then((function(e){return r(e)}))).then((function(n){g.textContent=n.name,q.textContent=n.about,a.textContent=u,t(f),s(e.target,M)})).catch((function(e){console.log(e),a.textContent="Ошибка"}))})),x.addEventListener("submit",(function(e){e.preventDefault();var n,i,l=e.target.querySelector(".popup__button"),d=l.textContent;l.textContent="Сохранение...",(n=U.value,i=A.value,fetch(o.baseUrl+"/cards",{method:"POST",headers:o.headers,body:JSON.stringify({name:n,link:i})}).then((function(e){return r(e)}))).then((function(n){var o=c(n.name,n.link,a,u,T,n._id,n.likes);B.prepend(o),l.textContent=d,t(v),e.target.reset(),s(e.target,M)})).catch((function(e){console.log(e),l.textContent="Ошибка"}))})),E.addEventListener("submit",(function(e){e.preventDefault();var n,c=e.target.querySelector(".popup__button"),a=c.textContent;c.textContent="Сохранение...",(n=L.value,fetch(o.baseUrl+"/users/me/avatar",{method:"PATCH",headers:o.headers,body:JSON.stringify({avatar:n})}).then((function(e){return r(e)}))).then((function(n){C.style="background-image: url('".concat(n.avatar,"')"),c.textContent=a,t(k),e.target.reset(),s(e.target,M)})).catch((function(e){console.log(e),c.textContent="Ошибка"}))})),Promise.all([fetch(o.baseUrl+"/users/me",{headers:o.headers}).then((function(e){return r(e)})),fetch(o.baseUrl+"/cards",{headers:o.headers}).then((function(e){return r(e)}))]).then((function(e){var t=e[0],n=e[1];g.textContent=t.name,C.style="background-image: url('".concat(t.avatar,"')"),q.textContent=t.about,n.forEach((function(e){var n=c(e.name,e.link,t._id===e.owner._id?a:null,u,T,e._id,e.likes,t);B.append(n)}))})).catch((function(e){console.log(e)}));var P,w,D,N,O,j,J,M={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};w=(P=M).formSelector,D=P.inputSelector,N=P.submitButtonSelector,O=P.inactiveButtonClass,j=P.inputErrorClass,J=P.errorClass,Array.from(document.querySelectorAll(w)).forEach((function(e){!function(e,t,n,o,r,c){var a=Array.from(e.querySelectorAll(t)),u=e.querySelector(n);i(a,u,o),a.forEach((function(t){t.addEventListener("input",(function(){!function(e,t,n,o){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n),r.classList.remove(o),r.textContent=""}(e,t,n,o):function(e,t,n,o,r){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o),c.textContent=n,c.classList.add(r)}(e,t,t.validationMessage,n,o)}(e,t,r,c),i(a,u,o)}))}))}(e,D,N,O,j,J)}))})();